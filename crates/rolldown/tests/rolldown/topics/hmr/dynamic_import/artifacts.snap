---
source: crates/rolldown_testing/src/integration_test.rs
---
# Assets

## chunk.js

```js
// HIDDEN [rolldown:runtime]
export { __toDynamicImportESM as a, __toCommonJS as i, __export as n, __toESM as o, __reExport as r, __commonJS as t };
```

## exist-dep-cjs.js

```js
import { t as __commonJS } from "./chunk.js";

//#region exist-dep-cjs.js
var require_exist_dep_cjs = /* @__PURE__ */ __commonJS({ "exist-dep-cjs.js": ((exports, module) => {
	const exist_dep_cjs_hot = __rolldown_runtime__.createModuleHotContext("exist-dep-cjs.js");
	__rolldown_runtime__.registerModule("exist-dep-cjs.js", module);
	exports.value = "exist-cjs";
}) });

//#endregion
export default require_exist_dep_cjs();

```

## exist-dep-esm.js

```js
import { n as __export } from "./chunk.js";

//#region exist-dep-esm.js
var exist_dep_esm_exports = /* @__PURE__ */ __export({ value: () => value });
const exist_dep_esm_hot = __rolldown_runtime__.createModuleHotContext("exist-dep-esm.js");
__rolldown_runtime__.registerModule("exist-dep-esm.js", { exports: exist_dep_esm_exports });
const value = "exist-esm";

//#endregion
export { value };
```

## main.js

```js
import { a as __toDynamicImportESM, i as __toCommonJS, n as __export, o as __toESM, r as __reExport } from "./chunk.js";

// HIDDEN [rolldown:hmr]
//#region hmr.js
var hmr_exports = /* @__PURE__ */ __export({ foo: () => foo });
const hmr_hot = __rolldown_runtime__.createModuleHotContext("hmr.js");
__rolldown_runtime__.registerModule("hmr.js", { exports: hmr_exports });
async function foo() {
	await import("./exist-dep-cjs.js").then(__toDynamicImportESM()).then(console.log);
	await import("./exist-dep-esm.js").then(console.log);
}
hmr_hot.accept((mod) => {
	if (mod) {
		console.log(".hmr", mod.foo);
	}
});

//#endregion
//#region main.js
var main_exports = {};
const main_hot = __rolldown_runtime__.createModuleHotContext("main.js");
__rolldown_runtime__.registerModule("main.js", { exports: main_exports });

//#endregion
```

# HMR Step 0

## Code

```js
//#region hmr.js
var init_hmr_0 = __rolldown_runtime__.createEsmInitializer((function() {
	try {
		var __rolldown_exports__ = __rolldown_runtime__.__export({
			foo: () => foo,
			bar: () => bar
		});
		__rolldown_runtime__.registerModule("hmr.js", { exports: __rolldown_exports__ });
		const hot_hmr = __rolldown_runtime__.createModuleHotContext("hmr.js");
		async function foo() {
			await Promise.resolve().then(() => __rolldown_runtime__.__toDynamicImportESM(__rolldown_runtime__.loadExports("exist-dep-cjs.js"))).then(console.log);
			await Promise.resolve().then(() => __rolldown_runtime__.loadExports("exist-dep-esm.js")).then(console.log);
		}
		async function bar() {
			await (require_new_dep_cjs_1(), Promise.resolve().then(() => __rolldown_runtime__.__toDynamicImportESM(__rolldown_runtime__.loadExports("new-dep-cjs.js")))).then(console.log);
			await (init_new_dep_esm_2(), Promise.resolve().then(() => __rolldown_runtime__.loadExports("new-dep-esm.js"))).then(console.log);
		}
		hot_hmr.accept((mod) => {
			if (mod) {
				console.log(".hmr", mod.foo);
			}
		});
	} finally {}
}));

//#endregion
//#region new-dep-cjs.js
var require_new_dep_cjs_1 = __rolldown_runtime__.createCjsInitializer((function(__rolldown_exports__, __rolldown_module__) {
	try {
		__rolldown_runtime__.registerModule("new-dep-cjs.js", __rolldown_module__);
		const hot_new_dep_cjs = __rolldown_runtime__.createModuleHotContext("new-dep-cjs.js");
		__rolldown_exports__.value = "new-cjs";
	} finally {}
}));

//#endregion
//#region new-dep-esm.js
var init_new_dep_esm_2 = __rolldown_runtime__.createEsmInitializer((function() {
	try {
		var __rolldown_exports__ = __rolldown_runtime__.__export({ value: () => value });
		__rolldown_runtime__.registerModule("new-dep-esm.js", { exports: __rolldown_exports__ });
		const hot_new_dep_esm = __rolldown_runtime__.createModuleHotContext("new-dep-esm.js");
		const value = "new-esm";
	} finally {}
}));

//#endregion
init_hmr_0()
__rolldown_runtime__.applyUpdates([['hmr.js', 'hmr.js']]);
```

## Meta

- update type: patch

### Hmr Boundaries

- boundary: hmr.js, accepted_via: hmr.js
